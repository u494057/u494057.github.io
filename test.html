<!DOCTYPE html>
<html>
<head>
	<title>Firebase Web Basics</title>

</head>
<body>

	<div class="mainDiv">
		<h1 align="left">Firebase File Upload</h1>
        <input id="film" placeholder="Nombre de la Pelicula"/><br><br>
        <input type="file" id="fileButton" value="upload"/><br><br>
        <progress id="uploader" value="0" max="100">0%</progress><br><br>
	</div>



  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-storage.js"></script>
  <script src="firebase_init.js"></script>

<script>
  var pelicula = document.getElementById('film');
  var uploader = document.getElementById('uploader');
  var fileButton = document.getElementById('fileButton');
  fileButton.addEventListener('change', function(e){
  var file = e.target.files[0];
  var storageRef = firebase.storage().ref('images_main/'+file.name);
  var task = storageRef.put(file);
  task.on('state_changed', function progress(snapshot) {
    var percentage = (snapshot.bytesTransferred/snapshot.totalBytes)*100;
    uploader.value = percentage;
  }, function error(err) {

  },function complete() {
      next();
  });

    
  function next(){
    storageRef.getDownloadURL()
    .then((url) => {
        //caratula = url;
        console.log(url);
    })
  }

/*
  var db = firebase.firestore();
  

  db.collection("films").where("original_title", '==', document.getElementById("film").value).update({
            comments: firebase.firestore.FieldValue.arrayUnion(docRef.id)
        });
*/

});  
  
  
</script>

</body>
</html>